<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu√©t & K·∫øt n·ªëi BLE</title>
<style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    button { padding: 12px 24px; font-size: 18px; cursor: pointer; }
</style>
</head>
<body>

<h1>Qu√©t & K·∫øt n·ªëi BLE</h1>
<button id="scanBtn">üîç Qu√©t BLE</button>
<p id="status"></p>

<script>
document.getElementById('scanBtn').addEventListener('click', async () => {
    const statusEl = document.getElementById('status');
    statusEl.textContent = "ƒêang qu√©t thi·∫øt b·ªã BLE...";
    try {
        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: ['battery_service'] // C√≥ th·ªÉ ƒë·ªïi service kh√°c
        });
        statusEl.textContent = "ƒê√£ ch·ªçn: " + (device.name || "Kh√¥ng t√™n");

        // K·∫øt n·ªëi GATT
        const server = await device.gatt.connect();
        statusEl.textContent += "\nƒê√£ k·∫øt n·ªëi th√†nh c√¥ng!";

        // V√≠ d·ª•: ƒë·ªçc m·ª©c pin n·∫øu c√≥ d·ªãch v·ª• battery_service
        const service = await server.getPrimaryService('battery_service');
        const characteristic = await service.getCharacteristic('battery_level');
        const value = await characteristic.readValue();
        const batteryLevel = value.getUint8(0);
        statusEl.textContent += `\nPin: ${batteryLevel}%`;

    } catch (err) {
        statusEl.textContent = "L·ªói: " + err;
        console.error(err);
    }
});
</script>

</body>
</html>
